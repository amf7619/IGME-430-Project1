<!DOCTYPE html>
<html lang="en">

<head>
    <title>Our simple HTTP server</title>
    <link rel="stylesheet" type="text/css" href="/style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    <script type="text/babel">
        const boardButtons = [];
        
        const parseJSON = (xhr, content) => {
            if (xhr.response && xhr.getResponseHeader('Content-Type') == 'application/json') {
                const obj = JSON.parse(xhr.response);
                console.dir(obj);

                if(obj.message) {
                    content.innerHTML += `<p>Message: ${obj.message}</p>`;
                }
                else {
                    content.innerHTML += `<p>${xhr.response}</p>`;
                }

                if(obj.board) {
                    for(let i = 0; i < obj.board.length; i++) {
                        boardButtons[i].value = obj.board[i];
                        boardButtons[i].style.backgroundColor = obj.board[i];
                    }
                }
            }
        }

        const handleResponse = (xhr, parseResponse) => {
            const content = document.querySelector('#content');

            switch (xhr.status) {
                case 200:
                    content.innerHTML = '<b>Success!</b>';
                    break;
                case 201:
                    content.innerHTML = '<b>Created!</b>';
                    break;
                case 204:
                    content.innerHTML = '<b>Updated (No Content)</b>';
                    break;
                case 400:
                    content.innerHTML = '<b>Bad Request</b>';
                    break;
                case 404:
                    content.innerHTML = '<b>Resource Not Found</b>';
                    break;
                default:
                    content.innerHTML = '<p>Error code not implemented by client!</p>'
                    break;
            }

            parseJSON(xhr, content);
        }

        const createXMLRequest = (form) => {
            const url = form.getAttribute('action');
            const method = form.getAttribute('method');

            const xhr = new XMLHttpRequest();
            xhr.open(method, url);

            return xhr;
        }

        const sendPost = (e, nameForm) => {
            e.preventDefault();

            const xhr = createXMLRequest(nameForm);

            const nameField = nameForm.querySelector('#nameField');

            xhr.setRequestHeader('Accept', 'application/json');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

            xhr.onload = () => handleResponse(xhr);

            const formData = `name=${nameField.value}`;
            xhr.send(formData);

            return false;
        };

        const requestUpdate = (e, userForm) => {
            const xhr = createXMLRequest(userForm);

            xhr.setRequestHeader('Accept', 'application/json');

            if (method === 'get') {
                xhr.onload = () => handleResponse(xhr, true);
            } else {
                xhr.onload = () => handleResponse(xhr, false);
            }

            xhr.send();

            e.preventDefault();
            return false;
        };

        const init = () => {
            const userForm = document.querySelector('#userForm');
            const nameForm = document.querySelector('#nameForm');

            const boardButtons = document.getElementsByClassName("boardButton");

            const getUsers = (e) => requestUpdate(e, userForm);
            const addUser = (e) => sendPost(e, nameForm);

            userForm.addEventListener('submit', getUsers);
            nameForm.addEventListener('submit', addUser);
        };

        window.onload = init;
    </script>
</head>

<body>
    <section id="top">
        <h3>Color Chart</h3>
        <form id="nameForm" action="/addBoard" method="post">
            <input id="nameField" type="text" name="name" placeholder="Board Name"/>
            <input type="submit" value="Create New Board"/>
        </form>
        <form id="userForm" action="/getBoardList" method="get">
            <input type="submit" value="Get All Boards"/>
        </form>
    </section>
    <section id="content">
    </section>
    <section id="board">
        <select id="colorPicker">
            <option value="#ffffff" selected>White</option>
            <option value="#ff0000">Red</option>
            <option value="#ff9933">Orange</option>
            <option value="#ffff00">Yellow</option>
            <option value="#00ff00">Green</option>
            <option value="#00ffff">Cyan</option>
            <option value="#0000ff">Blue</option>
            <option value="#ff00ff">Purple</option>
            <option value="#ffffff">Black</option>
        </select>
        <div id="boardCol">
            <div id="boardRow">
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
            </div>
            <div id="boardRow">
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
            </div>
            <div id="boardRow">
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
            </div>
            <div id="boardRow">
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
            </div>
            <div id="boardRow">
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
                <button class="boardButton" value="#ffffff"></button>
            </div>
        </div>
    </section>
    <section id="bottom">
        <h3>Pick a color</h3>
        <button class="colorPicker" id="whiteButton" value="#ffffff"></button>
        <button class="colorPicker" id="redButton" value="#ff0000"></button>
        <button class="colorPicker" id="orangeButton" value="#ff9933"></button>
        <button class="colorPicker" id="yellowButton" value="#ffff00"></button>
        <button class="colorPicker" id="greenButton" value="#00ff00"></button>
        <button class="colorPicker" id="cyanButton" value="#00ffff"></button>
        <button class="colorPicker" id="blueButton" value="#0000ff"></button>
        <button class="colorPicker" id="purpleButton" value="#ff00ff"></button>
        <button class="colorPicker" id="blackButton" value="#000000"></button>
    </section>
</body>

</html>